<html>
<head>
<link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<style>
body { padding: 15px; }
</style>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
<script>
window.lastCurrentTime = 0;
window.notifiedError = false;

function failed(e) {
	if (window.notifiedError) {
		return;
	}
	
	window.notifiedError = true;
	$.ajax({
		url: "@EXTERNAL_URL@/notifyError.js?url=" + encodeURIComponent("@VIDEO_URL@"),
	});
}
window.setInterval(function () {
	var videoTag = document.getElementById("video");
	
	if (videoTag.currentTime != 0) {
		if (window.lastCurrentTime == videoTag.currentTime && !window.notifiedError) {
			$.ajax({
				url: "@EXTERNAL_URL@/notifyError.js?reason=stuck&url=" + encodeURIComponent("@VIDEO_URL@"),
			});
			window.notifiedError = true;
		} else {
			window.lastCurrentTime = videoTag.currentTime;
		}
		
		$.ajax({
			url: "@EXTERNAL_URL@/notifyStatus.js?currenttime=" + videoTag.currentTime + "&end=" + videoTag.seekable.end(0)
		});	
	}
}, 30000);
</script>
</head>
<body>
<h2>Demo - Frame Accurate Ad Insertion</h2>
<div style="width:600px;">
	<h4>Viewer's Screen (Broadcast Output)</h4>
	<video id="video" width="600" height="400" src="@VIDEO_URL@" autoplay controls onerror="failed(event)"></video>
</div>
</body>
</html>
